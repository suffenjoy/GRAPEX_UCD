---
title: "PRI_RipTower_ts"
author: "Zhehan"
date: "January 16, 2020"
output: html_document
---

#Package
```{r}
library(lubridate)
library(ggplot2)
library(dplyr)
library(readxl)
library(data.table)
library(gridExtra)
library(zoo)
library(plantecophys)
library(reshape2)
library(ggpubr)
```

#Read Files into R
##2019
```{r}
path_pri <- "C:/Users/zt92/Box Sync/GRAPEX/PRI_tower"

#site1
site1 <- read_excel(file.path(path_pri, "RippSoils_1_PRI.xlsx"), skip = 5, col_names = c("TIMESTAMP","Record","Site","Down532","Down570","PRI_Ind"))
str(site1)
site1 <- site1[,c("TIMESTAMP","Site", "Down532", "Down570")]
site1$Site <- "Block_1"
#site2
site2 <- read_excel(file.path(path_pri, "RippSoils_2_PRI.xlsx"), skip = 5, col_names = c("TIMESTAMP","Record","Site","PRI","Down532","Up532-2","Down570","Up570-2","PRI_Ind1","PRI_Ind2", "NAs"))
site2 <- site2[,c("TIMESTAMP","Site", "Down532","Up532-2","Down570","Up570-2")]
site2$Site <- "Block_2"
#Site3
site3 <- read_excel(file.path(path_pri, "RippSoils_3_PRI.xlsx"), skip = 5, col_names = c("TIMESTAMP","Record","Site","Down532","Down570","PRI_Ind"))
str(site3)
site3 <- site3[,c("TIMESTAMP","Site", "Down532", "Down570")]
site3$Site <- "Block_3"
#Site4 
site4 <- read_excel(file.path(path_pri, "RippSoils_4_PRI.xlsx"), skip = 5, col_names = c("TIMESTAMP","Record","Site","PRI","Down532","Up532-4","Down570","Up570-4","PRI_Ind1","PRI_Ind2"))
site4 <- site4[,c("TIMESTAMP","Site", "Down532","Up532-4","Down570","Up570-4")]
site4$Site <- "Block_4"

```
##2020
```{r}
path_pri_2020 <- "C:/Users/tangz/Box Sync/GRAPEX/PRI_tower/2020"

#site1
site1_2020 <- read_excel(file.path(path_pri_2020, "RippSoils_1_PRI_2020.xlsx"), skip = 5, col_names = c("TIMESTAMP","Record","Site","Down532","Down570","PRI_Ind"))
str(site1_2020)
site1_2020 <- site1_2020[,c("TIMESTAMP","Site", "Down532", "Down570")]
site1_2020$Site <- "Block_1"
#site2
site2_2020 <- read_excel(file.path(path_pri_2020, "RippSoils_2_PRI_2020.xlsx"), skip = 5, col_names = c("TIMESTAMP","Record","Site","PRI","Down532","Up532-2","Down570","Up570-2","PRI_Ind1","PRI_Ind2", "NAs"))
site2_2020 <- site2_2020[,c("TIMESTAMP","Site", "Down532","Up532-2","Down570","Up570-2")]
site2_2020$Site <- "Block_2"
#Site3
site3_2020 <- read_excel(file.path(path_pri_2020, "RippSoils_3_PRI_2020.xlsx"), skip = 5, col_names = c("TIMESTAMP","Record","Site","Down532","Down570","PRI_Ind"))
str(site3_2020)
site3_2020 <- site3_2020[,c("TIMESTAMP","Site", "Down532", "Down570")]
site3_2020$Site <- "Block_3"
#Site4 
site4_2020 <- read_excel(file.path(path_pri_2020, "RippSoils_4_PRI_2020.xlsx"), skip = 5, col_names = c("TIMESTAMP","Record","Site","PRI","Down532","Up532-4","Down570","Up570-4","PRI_Ind1","PRI_Ind2"))
site4_2020 <- site4_2020[,c("TIMESTAMP","Site", "Down532","Up532-4","Down570","Up570-4")]
site4_2020$Site <- "Block_4"
site4_2020$Down532 <- as.numeric(site4_2020$Down532)
site4_2020$`Up532-4` <- as.numeric(site4_2020$`Up532-4`)
site4_2020$Down570 <- as.numeric(site4_2020$Down570)
site4_2020$`Up570-4` <- as.numeric(site4_2020$`Up570-4`)
```

#Data cleaning 
##2019
```{r}
##add date 
site1$Date <- lubridate::date(site1$TIMESTAMP)
site2$Date <- lubridate::date(site2$TIMESTAMP)
site3$Date <- lubridate::date(site3$TIMESTAMP)
site4$Date <- lubridate::date(site4$TIMESTAMP)
#subset the time between 05/21 to 08/29
site1 <- subset(site1, Date>= "2019-05-21" & Date <= "2019-08-26")
site2 <- subset(site2, Date>= "2019-05-21" & Date <= "2019-08-26")
site3 <- subset(site3, Date>= "2019-05-21" & Date <= "2019-08-26")
site4 <- subset(site4, Date>= "2019-05-21" & Date <= "2019-08-26")
dim(site1);dim(site2);dim(site3);dim(site4) #they have the same dimension
#there're quite a lot of missing data in site 2 (mainly from 07/26 to 08/09)

##Combine them together 
PRIall <- data.frame("Site" = rep(c("Block1","Block2","Block3","Block4"), each = 9408), 
                     "TIMESTAMP" = c(site1$TIMESTAMP, site2$TIMESTAMP, site3$TIMESTAMP, site4$TIMESTAMP),
                     "Down532" = c(site1$Down532, site2$Down532, site3$Down532, site4$Down532), 
                     "Down570" = c(site1$Down570, site2$Down570, site3$Down570, site4$Down570),
                     "Up532-2" = c(site2$`Up532-2`, site2$`Up532-2`, site2$`Up532-2`, site2$`Up532-2`),
                     "Up570-2" = c(site2$`Up570-2`, site2$`Up570-2`, site2$`Up570-2`, site2$`Up570-2`),
                     "R532-2" = 0, 
                     "R570-2" = 0,
                     "PRI-2" = 0, 
                     "Up532-4" = c(site4$`Up532-4`, site4$`Up532-4`, site4$`Up532-4`, site4$`Up532-4`),
                     "Up570-4" = c(site4$`Up570-4`, site4$`Up570-4`, site4$`Up570-4`, site4$`Up570-4`),
                     "R532-4" = 0,
                     "R570-4" = 0,
                     "PRI-4" = 0,
                     "Up532-a" = 0, 
                     "Up570-a" = 0, 
                     "R532-a" = 0, 
                     "R570-a" = 0,
                     "PRI-a" = 0)
PRIall$Date <- lubridate::date(PRIall$TIMESTAMP)
dim(PRIall)

##calculate some columns 
PRIall$R532.2 = PRIall$Down532/PRIall$Up532.2
PRIall$R570.2 = PRIall$Down570/PRIall$Up570.2
PRIall$PRI.2 = (PRIall$R532.2 - PRIall$R570.2)/(PRIall$R532.2 + PRIall$R570.2)
PRIall$R532.4 = PRIall$Down532/PRIall$Up532.4
PRIall$R570.4 = PRIall$Down570/PRIall$Up570.4
PRIall$PRI.4 = (PRIall$R532.4 - PRIall$R570.4)/(PRIall$R532.4 + PRIall$R570.4)
PRIall$Up532.a = rowMeans(cbind(PRIall$Up532.2, PRIall$Up532.4),na.rm = TRUE)
PRIall$Up570.a = rowMeans(cbind(PRIall$Up570.2, PRIall$Up570.4),na.rm = TRUE)
PRIall$R532.a = PRIall$Down532/PRIall$Up532.a
PRIall$R570.a = PRIall$Down570/PRIall$Up570.a
PRIall$PRI.a = (PRIall$R532.a - PRIall$R570.a)/(PRIall$R532.a + PRIall$R570.a)

PRIall$Time <- lubridate::hour(PRIall$TIMESTAMP) + minute(PRIall$TIMESTAMP)/60 + second(PRIall$TIMESTAMP)/3600
```
##2020
```{r}
##add date 
site1_2020$Date <- lubridate::date(site1_2020$TIMESTAMP)
site2_2020$Date <- lubridate::date(site2_2020$TIMESTAMP)
site3_2020$Date <- lubridate::date(site3_2020$TIMESTAMP)
site4_2020$Date <- lubridate::date(site4_2020$TIMESTAMP)
#subset the time between 05/21 to 08/29
site1_2020 <- subset(site1_2020, Date>= "2020-05-22" & Date <= "2020-07-06")
site2_2020 <- subset(site2_2020, Date>= "2020-05-22" & Date <= "2020-07-06")
site3_2020 <- subset(site3_2020, Date>= "2020-05-22" & Date <= "2020-07-06")
site4_2020 <- subset(site4_2020, Date>= "2020-05-22" & Date <= "2020-07-06")
dim(site1_2020);dim(site2_2020);dim(site3_2020);dim(site4_2020) #they have the same dimension
#there're quite a lot of missing data in site 2 (mainly from 07/26 to 08/09)

##Combine them together 
PRIall_2020 <- data.frame("Site" = rep(c("Block1","Block2","Block3","Block4"), each = 4416), 
                     "TIMESTAMP" = c(site1_2020$TIMESTAMP, site2_2020$TIMESTAMP, site3_2020$TIMESTAMP, site4_2020$TIMESTAMP),
                     "Down532" = c(site1_2020$Down532, site2_2020$Down532, site3_2020$Down532, site4_2020$Down532), 
                     "Down570" = c(site1_2020$Down570, site2_2020$Down570, site3_2020$Down570, site4_2020$Down570),
                     "Up532-2" = c(site2_2020$`Up532-2`, site2_2020$`Up532-2`, site2_2020$`Up532-2`, site2_2020$`Up532-2`),
                     "Up570-2" = c(site2_2020$`Up570-2`, site2_2020$`Up570-2`, site2_2020$`Up570-2`, site2_2020$`Up570-2`),
                     "R532-2" = 0, 
                     "R570-2" = 0,
                     "PRI-2" = 0, 
                     "Up532-4" = c(site4_2020$`Up532-4`, site4_2020$`Up532-4`, site4_2020$`Up532-4`, site4_2020$`Up532-4`),
                     "Up570-4" = c(site4_2020$`Up570-4`, site4_2020$`Up570-4`, site4_2020$`Up570-4`, site4_2020$`Up570-4`),
                     "R532-4" = 0,
                     "R570-4" = 0,
                     "PRI-4" = 0,
                     "Up532-a" = 0, 
                     "Up570-a" = 0, 
                     "R532-a" = 0, 
                     "R570-a" = 0,
                     "PRI-a" = 0)
PRIall_2020$Date <- lubridate::date(PRIall_2020$TIMESTAMP)
dim(PRIall_2020)

##calculate some columns 
PRIall_2020$R532.2 = PRIall_2020$Down532/PRIall_2020$Up532.2
PRIall_2020$R570.2 = PRIall_2020$Down570/PRIall_2020$Up570.2
PRIall_2020$PRI.2 = (PRIall_2020$R532.2 - PRIall_2020$R570.2)/(PRIall_2020$R532.2 + PRIall_2020$R570.2)
PRIall_2020$R532.4 = PRIall_2020$Down532/PRIall_2020$Up532.4
PRIall_2020$R570.4 = PRIall_2020$Down570/PRIall_2020$Up570.4
PRIall_2020$PRI.4 = (PRIall_2020$R532.4 - PRIall_2020$R570.4)/(PRIall_2020$R532.4 + PRIall_2020$R570.4)
PRIall_2020$Up532.a = rowMeans(cbind(PRIall_2020$Up532.2, PRIall_2020$Up532.4),na.rm = TRUE)
PRIall_2020$Up570.a = rowMeans(cbind(PRIall_2020$Up570.2, PRIall_2020$Up570.4),na.rm = TRUE)
PRIall_2020$R532.a = PRIall_2020$Down532/PRIall_2020$Up532.a
PRIall_2020$R570.a = PRIall_2020$Down570/PRIall_2020$Up570.a
PRIall_2020$PRI.a = (PRIall_2020$R532.a - PRIall_2020$R570.a)/(PRIall_2020$R532.a + PRIall_2020$R570.a)

PRIall_2020$Time <- lubridate::hour(PRIall_2020$TIMESTAMP) + minute(PRIall_2020$TIMESTAMP)/60 + second(PRIall_2020$TIMESTAMP)/3600

```

#Seasonal Change 
##Function to select Only noon time and dates
```{r}
noon_selection <- function(data, early, late){
  data_noon <- data[data$Time >= early & data$Time <= late,]
  return(data_noon)
}

date_selection <- function(data, begin, end){
  data_date_selection <- data[data$Date >= begin & data$Date <= end,]
  return(data_date_selection)
}


#apply
PRInoon <- noon_selection(PRIall, early = 12, late = 14)
unique(PRInoon$Time)
```
##Function to calculate daily average using the noon time only
```{r}
#function  
daily_ave <- function(data, early, late, begin, end){
  #between certain dates
  PRI_date <- date_selection(data, begin, end)
  #noon average
  PRI_date_noon <- noon_selection(PRI_date, early, late)
  #split
  PRI_split <- split(PRI_date_noon, PRI_date_noon$Date)
  #lapply
  PRI_ave <- lapply(lapply(PRI_split, "[[", 14), mean)
  PRI_ave <- data.frame("Date" = ymd(names(PRI_ave)), "PRI" = unlist(PRI_ave))
  #result
  row.names(PRI_ave) <- NULL
  return(PRI_ave)
}
```
##Apply the function 
###2019
```{r}
PRI_daily_1 <- daily_ave(subset(PRIall, Site == "Block1"), 11,15, "2019-05-21", "2019-08-26")
PRI_daily_1$Site = "Block1"
PRI_daily_2 <- daily_ave(subset(PRIall, Site == "Block2"), 11,15, "2019-05-21", "2019-08-26")
PRI_daily_2$Site = "Block2"
PRI_daily_3 <- daily_ave(subset(PRIall, Site == "Block3"), 11,15, "2019-05-21", "2019-08-26")
PRI_daily_3$Site = "Block3"
PRI_daily_4 <- daily_ave(subset(PRIall, Site == "Block4"), 11,15, "2019-05-21", "2019-08-26")
PRI_daily_4$Site = "Block4"
PRI_daily <- rbind(PRI_daily_1, PRI_daily_2, PRI_daily_3, PRI_daily_4)

ggplot(PRI_daily, aes(x = Date, y = PRI, color = as.factor(Site))) + geom_point() + geom_line() + ggtitle("PRI Daily Average") + ylim(c(-0.15, 0.15)) + labs(color = "Site")
ggplot(subset(PRI_daily, Site!= "Block4"), aes(x = Date, y = PRI, color = as.factor(Site))) + geom_point() + geom_line() + ggtitle("PRI Daily Average") + ylim(c(-0.15, 0.1)) + labs(color = "Site")

```
###2020
```{r}
PRI_daily_1_2020 <- daily_ave(subset(PRIall_2020, Site == "Block1"), 11,15, "2020-05-22", "2020-07-06")
PRI_daily_1_2020$Site = "Block1"
PRI_daily_2_2020 <- daily_ave(subset(PRIall_2020, Site == "Block2"), 11,15, "2020-05-22", "2020-07-06")
PRI_daily_2_2020$Site = "Block2"
PRI_daily_3_2020 <- daily_ave(subset(PRIall_2020, Site == "Block3"), 11,15, "2020-05-22", "2020-07-06")
PRI_daily_3_2020$Site = "Block3"
PRI_daily_4_2020 <- daily_ave(subset(PRIall_2020, Site == "Block4"), 11,15, "2020-05-22", "2020-07-06")
PRI_daily_4_2020$Site = "Block4"
PRI_daily_2020 <- rbind(PRI_daily_1_2020, PRI_daily_2_2020, PRI_daily_3_2020, PRI_daily_4_2020)

ggplot(PRI_daily_2020, aes(x = Date, y = PRI, color = as.factor(Site))) + geom_point() + geom_line() + ggtitle("PRI Daily Average 2020") + labs(color = "Site") + ggpubr::theme_pubr() #+ ylim(c(-0.15, 0.15))
#ggplot(subset(PRI_daily, Site!= "Block4"), aes(x = Date, y = PRI, color = as.factor(Site))) + geom_point() + geom_line() + ggtitle("PRI Daily Average 2020") + ylim(c(-0.15, 0.1)) + labs(color = "Site")

```

#Moving average to smooth the data
##2019
```{r}
PRI_5day_1_2020 <- rollmean(PRI_daily_1_2020$PRI, k = 5, fill = NA)
PRI_5day_1_2020 <- data.frame("Date" = PRI_daily_1_2020$Date, "PRI" = PRI_5day_1_2020, Site = "Block1")
PRI_5day_2_2020 <- rollmean(PRI_daily_2_2020$PRI, k = 5, fill = NA)
PRI_5day_2_2020 <- data.frame("Date" = PRI_daily_2_2020$Date, "PRI" = PRI_5day_2_2020, Site = "Block2")
PRI_5day_3_2020 <- rollmean(PRI_daily_3_2020$PRI, k = 5, fill = NA)
PRI_5day_3_2020 <- data.frame("Date" = PRI_daily_3_2020$Date, "PRI" = PRI_5day_3_2020, Site = "Block3")
PRI_5day_4_2020 <- rollmean(PRI_daily_4_2020$PRI, k = 5, fill = NA)
PRI_5day_4_2020 <- data.frame("Date" = PRI_daily_4_2020$Date, "PRI" = PRI_5day_4_2020, Site = "Block4")

PRI_5day_2020 <- rbind(PRI_5day_1_2020, PRI_5day_2_2020, PRI_5day_3_2020, PRI_5day_4_2020)
ggplot(PRI_5day_2020, aes(x = Date, y = PRI, color = as.factor(Site))) + geom_point() + geom_line() + ggtitle("PRI Time Series (5-Day-Average)") + labs(color = "Site")

#without Block 4
ggplot(subset(PRI_5day, Site!="Block4"), aes(x = Date, y = PRI, color = as.factor(Site))) + geom_point()  + geom_line() + ggtitle("PRI Time Series (5-Day-Average)") + labs(color = "Site")

```
##2020
```{r}
PRI_5day_1 <- rollmean(PRI_daily_1$PRI, k = 5, fill = NA)
PRI_5day_1 <- data.frame("Date" = PRI_daily_1$Date, "PRI" = PRI_5day_1, Site = "Block1")
PRI_5day_2 <- rollmean(PRI_daily_2$PRI, k = 5, fill = NA)
PRI_5day_2 <- data.frame("Date" = PRI_daily_2$Date, "PRI" = PRI_5day_2, Site = "Block2")
PRI_5day_3 <- rollmean(PRI_daily_3$PRI, k = 5, fill = NA)
PRI_5day_3 <- data.frame("Date" = PRI_daily_3$Date, "PRI" = PRI_5day_3, Site = "Block3")
PRI_5day_4 <- rollmean(PRI_daily_4$PRI, k = 5, fill = NA)
PRI_5day_4 <- data.frame("Date" = PRI_daily_4$Date, "PRI" = PRI_5day_4, Site = "Block4")

PRI_5day <- rbind(PRI_5day_1, PRI_5day_2, PRI_5day_3, PRI_5day_4)
ggplot(PRI_5day, aes(x = Date, y = PRI, color = as.factor(Site))) + geom_point() + geom_line() + ggtitle("PRI Time Series (5-Day-Average)") + labs(color = "Site") + ggpubr::theme_pubr()

```

#Weather data from CIMIS
##Read CIMIS data
```{r}
path_weather <- "C:/Users/zt92/Box Sync/GRAPEX/Weather"
cimis_rip <- read.csv(file.path(path_weather, "CIMIS#007_Hourly_20190521_20190901.csv"))
head(cimis_rip)
cimis_rip$Date <- as.Date(as.character(cimis_rip$Date), "%m/%d/%Y")

cimis_rip <- cimis_rip[!is.na(cimis_rip$Date),]
cimis_rip$Hour..PST. <- sapply(cimis_rip$Hour..PST., function(x){
  if(nchar(x)==3){x=paste0("0",x)}
    else{x = as.character(x)}}
  )
cimis_rip$Time <- paste(cimis_rip$Date, cimis_rip$Hour..PST.)
cimis_rip$Time <- strptime(cimis_rip$Time, format = "%Y-%m-%d %H%M")
#subset
cimis_rip <- cimis_rip[,c("Date", "Air.Temp..C.", "Rel.Hum....", "Sol.Rad..W.sq.m.","Time")]
names(cimis_rip) <- c("Date", "Air_Temp", "Rel_Hum", "Sol_Rad", "TIMESTAMP")
cimis_rip$Time <- hour(cimis_rip$TIMESTAMP) + minute(cimis_rip$TIMESTAMP)/60 + second(cimis_rip$TIMESTAMP)/3600
head(cimis_rip)
tail(cimis_rip)
#from 05/21 to 08/26
cimis_rip <- subset(cimis_rip, Date >= "2019-05-21", Date <= "2019-08-26")

#calculate VPD
cimis_rip$VPD <- RHtoVPD(RH = cimis_rip$Rel_Hum, TdegC = cimis_rip$Air_Temp)

ggplot(subset(cimis_rip, Date == "2019-08-22"), aes(x = Time, y = Air_Temp)) + geom_line()
```
##Diurnal cycle
```{r}
cimis_diurnal <- subset(cimis_rip, Time >= 8 & Time <= 19)

p1 <- ggplot(subset(cimis_diurnal, Date >= "2019-06-24" & Date <= "2019-06-27"), aes(x = Time, y = VPD, color = as.factor(Date))) + geom_line(size = 1)+labs(color ="Date")
p2 <- ggplot(subset(cimis_diurnal, Date >= "2019-07-28" & Date <= "2019-07-31"), aes(x = Time, y = VPD, color = as.factor(Date))) + geom_line(size = 1)+labs(color ="Date")
p3 <- ggplot(subset(cimis_diurnal, Date >= "2019-08-21" & Date <= "2019-08-24"), aes(x = Time, y = VPD, color = as.factor(Date))) + geom_line(size = 1)+labs(color ="Date")
grid.arrange(p1,p2,p3, nrow =3 )
```

##Noon average
```{r}
cimis_noon <- subset(cimis_rip, Time > 11 & Time <15)
cimis_noon <- aggregate(cimis_noon[,c("Air_Temp","Rel_Hum","Sol_Rad","VPD")], by = list("Date"  = cimis_noon$Date), FUN = mean)
cimis_noon$VPD <- RHtoVPD(RH = cimis_noon$Rel_Hum, TdegC = cimis_noon$Air_Temp)

ggplot(cimis_noon, aes(x = Date, y = Air_Temp)) + geom_line()
ggplot(cimis_noon, aes(x = Date, y = VPD)) + geom_line()
dates_s2 <- unique(PRIdaily_s2[!is.na(PRIdaily_s2$NDVI),]$Date)
ggplot(cimis_noon[cimis_noon$Date %in% dates_s2,], aes(x = Date, y = Sol_Rad)) + geom_line()
dates_s2 <- unique(PRIdaily_s2[!is.na(PRIdaily_s2$NDVI),]$Date)

p <- ggplot(cimis_noon, aes(x = Date))
p <- p + geom_line(aes(y = Air_Temp, color = "Air Temperature"), size = 0.8)
p <- p + geom_line(aes(y = VPD*7, color = "VPD"), size = 0.8)
p <- p + scale_y_continuous(sec.axis = sec_axis(~./7,name = "VPD (kPa)"))
p <- p + scale_color_manual(values = c("blue","red"))
p <- p + labs(y = "Air Temperature (°C)", x = "Date", color = "Weather Parameter")
p <- p + theme(legend.position = c(0.8, 0.1))
p
```

#Combine with NDVI and LAI
##Read from GEE
```{r}
##NDVI 
path_gee <- "C:/Users/zt92/Box Sync/GRAPEX/GEE"
s2_ndvi <- read.csv(file.path(path_gee, "Sen2_NDVI_RIPtower_20190315_20191101.csv"))
names(s2_ndvi) <- c("Date","Block4","Block3","Block2","Block1")
s2_ndvi$Date <- as.Date(s2_ndvi$Date, format = "%b %d, %Y")
#change from wide to long 
s2_ndvi <- reshape2::melt(s2_ndvi, id.vars = c("Date"), value.name = "NDVI")
names(s2_ndvi)[2] <- "Site"
str(s2_ndvi)
#subset dates 
s2_ndvi <- subset(s2_ndvi, Date != "2019-05-27")
s2_ndvi <- subset(s2_ndvi, Date >= "2019-05-21" & Date <= "2019-08-26")
#there are two values per date per point 
s2_ndvi <- aggregate(s2_ndvi$NDVI, by = list("Date" = s2_ndvi$Date, "Site"= s2_ndvi$Site), FUN = mean)
names(s2_ndvi)[3] <- "NDVI"
ggplot(s2_ndvi[!is.na(s2_ndvi$NDVI),], aes(x = Date, y = NDVI, color = Site)) + geom_point() + geom_line()


##LAI
s2_lai <- read.csv(file.path(path_gee, "Sen2_LAI_RIPtower_20190315_20191101.csv"))
names(s2_lai) <- c("Date","Block4","Block3","Block2","Block1")
s2_lai$Date <- as.Date(s2_lai$Date, format = "%b %d, %Y")
#change from wide to long 
s2_lai <- reshape2::melt(s2_lai, id.vars = c("Date"), value.name = "LAI")
names(s2_lai)[2] <- "Site"
str(s2_lai)
#subset dates 
s2_lai <- subset(s2_lai, Date != "2019-05-27")
s2_lai <- subset(s2_lai, Date >= "2019-05-21" & Date <= "2019-08-26")
#there are two values per date per point 
s2_lai <- aggregate(s2_lai$LAI, by = list("Date" = s2_lai$Date, "Site"= s2_lai$Site), FUN = mean)
names(s2_lai)[3] <- "LAI"
ggplot(s2_lai[!is.na(s2_lai$LAI),], aes(x = Date, y = LAI, color = Site)) + geom_point() + geom_line()

```

##Combine with the Daily PRI 
```{r}
#PRIdaily_s2 <- merge(PRI_5day, s2_ndvi, by = c("Site","Date"), all.x = TRUE)
PRIdaily_s2 <- merge(PRI_5day, s2_ndvi, by = c("Site","Date"))
PRIdaily_s2 <- merge(PRIdaily_s2, s2_lai, by = c("Site","Date"))

dim(PRIdaily_s2)
dim(PRI_daily)
dim(PRI_5day)

head(PRIdaily_s2)

PRIdaily_s2$NDVI
PRIdaily_s2$PRI_NDVI <- PRIdaily_s2$PRI/PRIdaily_s2$NDVI
PRIdaily_s2$PRI_LAI <- PRIdaily_s2$PRI/PRIdaily_s2$LAI

ggplot(PRIdaily_s2, aes(x = Date, y= PRI_NDVI, color = Site)) + geom_point() + geom_line()
ggplot(PRIdaily_s2, aes(x = Date, y= PRI_LAI, color = Site)) + geom_point() + geom_line()

#scale to (0,1)
PRIdaily_s2 <- PRIdaily_s2 %>% mutate(PRI_scale = (PRI - min(PRI, na.rm = TRUE))/(max(PRI, na.rm = TRUE)-min(PRI, na.rm = TRUE)))
#distribution 
hist(PRIdaily_s2$PRI)
hist(PRIdaily_s2$PRI_scale)

PRIdaily_s2 <- PRIdaily_s2 %>% mutate(NDVI_scale = (NDVI - min(NDVI, na.rm = TRUE))/(max(NDVI, na.rm = TRUE)-min(NDVI, na.rm = TRUE)))
hist(PRIdaily_s2$NDVI_scale)
PRIdaily_s2 <- PRIdaily_s2 %>% mutate(LAI_scale = (LAI - min(LAI, na.rm = TRUE))/(max(LAI, na.rm = TRUE)-min(LAI, na.rm = TRUE)))
hist(PRIdaily_s2$LAI_scale)

PRIdaily_s2$PRI_NDVI_scale <- PRIdaily_s2$PRI_scale - PRIdaily_s2$NDVI_scale
PRIdaily_s2$PRI_LAI_scale <- PRIdaily_s2$PRI_scale - PRIdaily_s2$LAI_scale

ggplot(PRIdaily_s2, aes(x = Date, y= PRI_scale, color = Site)) + geom_point() + geom_line()
ggplot(PRIdaily_s2, aes(x = Date, y= LAI_scale, color = Site)) + geom_point() + geom_line()

ggplot(PRIdaily_s2, aes(x = Date, y= PRI_NDVI_scale, color = Site)) + geom_point() + geom_line()


ggplot(PRIdaily_s2[!is.na(PRIdaily_s2$PRI_LAI_scale),], aes(x = Date, y= PRI_LAI_scale, color = Site)) + geom_point(size = 3)  + theme_light() + ylab("PRIscale - LAIscale") + theme(text= element_text(size =  16)) + geom_line(size = 1)

ggplot(PRIdaily_s2[!is.na(PRIdaily_s2$PRI_LAI_scale),], aes(x = Date, y= PRI, color = Site)) + geom_point(size = 3) + ylab("PRI") + theme(text= element_text(size =  16)) + geom_line(size = 1)
ggplot(PRIdaily_s2[!is.na(PRIdaily_s2$PRI_LAI_scale),], aes(x = Date, y= LAI, color = Site)) + geom_point(size = 3)  + ylab("LAIgreen") + theme(text= element_text(size =  16)) + geom_line(size = 1)



ggplot(s2_lai[!is.na(s2_lai$LAI),], aes(x = Date, y = LAI, color = Site)) + geom_point() + geom_line()

#https://www.sciencedirect.com/science/article/pii/S0034425716304941#f0055

#add chlorophyll content index
#calculate 5-day average instead of moving window

plot(PRIdaily_s2$NDVI, PRIdaily_s2$PRI)
ggplot(PRIdaily_s2, aes(x = NDVI_scale, y = PRI_scale, color = Site)) + geom_point() + geom_smooth(method= "lm")


temp_split <- split(PRIdaily_s2, PRIdaily_s2$Site)
p1 <- ggplot(subset(PRIdaily_s2, Site == "Block1"), aes(x = NDVI, y = PRI, color = "red"))+ geom_point(size = 3)+geom_smooth(method = "lm", se = FALSE, size = 2, color = "blue") 
p1
lapply(temp_split, function(x){summary(lm(x$NDVI~x$PRI))$r.squared})
lapply(temp_split, function(x){summary(lm(x$NDVI_scale~x$PRI_scale))$r.squared})


```


#Diurnal Cycle

###Upward sensor (solar radiantion )
####2019
```{r}
#diurnal cycle 
##site 2
p1 <- ggplot(subset(PRIall, Date > "2019-06-21" & Date < "2019-07-01"), aes(x = TIMESTAMP, y = Up532.2)) + geom_line() + ggtitle("Incoming Radiation Up532 Site 2") + xlab("") + ylab("Up532")
p2 <- ggplot(subset(PRIall, Date > "2019-06-21" & Date < "2019-07-01"), aes(x = TIMESTAMP, y = Up570.2)) + geom_line() + ggtitle("Incoming Radiation Up570 Site 2") + xlab("Time") + ylab("Up570")
grid.arrange(p1, p2, nrow = 2)
##site 4
p1 <- ggplot(subset(PRIall, Date > "2019-06-21" & Date < "2019-07-01"), aes(x = TIMESTAMP, y = Up532.4)) + geom_line() + ggtitle("Incoming Radiation Up532 Site 4") + xlab(" ") + ylab("Up532")
p2 <- ggplot(subset(PRIall, Date > "2019-06-21" & Date < "2019-07-01"), aes(x = TIMESTAMP, y = Up570.4)) + geom_line() + ggtitle("Incoming Radiation Up570 Site 4") + xlab("Time") + ylab("Up570")
grid.arrange(p1, p2, nrow = 2)
##Average
p1 <- ggplot(subset(PRIall, Date > "2019-06-21" & Date < "2019-07-01"), aes(x = TIMESTAMP, y = Up532.a)) + geom_line() + ggtitle("Incoming Radiation Up532 Average of Site 2 & Site 4") + xlab(" ") + ylab("Up532")
p2 <- ggplot(subset(PRIall, Date > "2019-06-21" & Date < "2019-07-01"), aes(x = TIMESTAMP, y = Up570.a)) + geom_line() + ggtitle("Incoming Radiation Up570 Average of Site 2 & Site 4") + xlab("Time") + ylab("Up570")
grid.arrange(p1, p2, nrow = 2)


```
####2020
```{r}
##site 2
p1 <- ggplot(subset(PRIall_2020, Date > "2020-05-22" & Date < "2020-07-06"), aes(x = TIMESTAMP, y = Up532.2)) + geom_line() + ggtitle("Incoming Radiation Up532 Site 2") + xlab("") + ylab("Up532")
p2 <- ggplot(subset(PRIall_2020, Date > "2020-05-22" & Date < "2020-07-06"), aes(x = TIMESTAMP, y = Up570.2)) + geom_line() + ggtitle("Incoming Radiation Up570 Site 2") + xlab("Time") + ylab("Up570")
grid.arrange(p1, p2, nrow = 2)
##site 4
p1 <- ggplot(subset(PRIall_2020, Date > "2020-05-22" & Date < "2020-07-06"), aes(x = TIMESTAMP, y = Up532.4)) + geom_line() + ggtitle("Incoming Radiation Up532 Site 4") + xlab(" ") + ylab("Up532")
p2 <- ggplot(subset(PRIall_2020, Date > "2020-05-22" & Date < "2020-07-06"), aes(x = TIMESTAMP, y = Up570.4)) + geom_line() + ggtitle("Incoming Radiation Up570 Site 4") + xlab("Time") + ylab("Up570")
grid.arrange(p1, p2, nrow = 2)
##Average
p1 <- ggplot(subset(PRIall_2020, Date > "2020-05-22" & Date < "2020-07-06"), aes(x = TIMESTAMP, y = Up532.a)) + geom_line() + ggtitle("Incoming Radiation Up532 Average of Site 2 & Site 4") + xlab(" ") + ylab("Up532")
p2 <- ggplot(subset(PRIall_2020, Date > "2020-05-22" & Date < "2020-07-06"), aes(x = TIMESTAMP, y = Up570.a)) + geom_line() + ggtitle("Incoming Radiation Up570 Average of Site 2 & Site 4") + xlab("Time") + ylab("Up570")
grid.arrange(p1, p2, nrow = 2)


```

###Downward sensor diurnal cycle
####2019
```{r}
##Site 1
p1 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block1"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 Down532 Diurnal Radiance Late June")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p2 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block1"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 Down570 Diurnal Radiance Late June")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p3 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block1"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 Down532 Diurnal Radiance Late July")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p4 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block1"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 Down570 Diurnal Radiance Late July")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p5 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block1"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 Down532 Diurnal Radiance Late August")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p6 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block1"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 Down570 Diurnal Radiance Late August") + ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

#site 3
p1 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block3"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 Down532 Diurnal Radiance Late June")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p2 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block3"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 Down570 Diurnal Radiance Late June")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p3 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block3"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 Down532 Diurnal Radiance Late July")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p4 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block3"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 Down570 Diurnal Radiance Late July")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p5 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block3"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 Down532 Diurnal Radiance Late August")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p6 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block3"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 Down570 Diurnal Radiance Late August") + ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)


#Site 4
p1 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block4"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 Down532 Diurnal Radiance Late June")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p2 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block4"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 Down570 Diurnal Radiance Late June")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p3 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block4"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 Down532 Diurnal Radiance Late July")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p4 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block4"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 Down570 Diurnal Radiance Late July")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p5 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block4"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 Down532 Diurnal Radiance Late August")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p6 <- ggplot(subset(noon_selection(PRIall, 5, 20), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block4"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 Down570 Diurnal Radiance Late August") + ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

```
####2020
```{r}
##Site 1
p1 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-06-05" & Date < "2020-06-28" & Site == "Block1"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 Down532 Diurnal Radiance Late June")+ ylab("Radiance (W/m2·sr)") + labs(color = "Date")# + ylim(c(0.00, 0.03))
p1
p2 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block1"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 Down570 Diurnal Radiance Late June")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p3 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block1"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 Down532 Diurnal Radiance Late July")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p4 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block1"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 Down570 Diurnal Radiance Late July")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p5 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block1"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 Down532 Diurnal Radiance Late August")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p6 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block1"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 Down570 Diurnal Radiance Late August") + ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

#site 3
p1 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-06-12" & Date < "2020-06-28" & Site == "Block3"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 Down532 Diurnal Radiance Late June")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p1
p2 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-05-22" & Date < "2020-06-28" & Site == "Block3"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 Down570 Diurnal Radiance Late June")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p3 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block3"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 Down532 Diurnal Radiance Late July")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p4 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block3"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 Down570 Diurnal Radiance Late July")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p5 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block3"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 Down532 Diurnal Radiance Late August")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p6 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block3"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 Down570 Diurnal Radiance Late August") + ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)


#Site 4
p1 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-05-22" & Date < "2020-06-28" & Site == "Block4"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 Down532 Diurnal Radiance Late June")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p2 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-05-22" & Date < "2020-06-28" & Site == "Block4"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 Down570 Diurnal Radiance Late June")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p3 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block4"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 Down532 Diurnal Radiance Late July")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p4 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block4"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 Down570 Diurnal Radiance Late July")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p5 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block4"), aes(x = Time, y = Down532, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 Down532 Diurnal Radiance Late August")+ ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
p6 <- ggplot(subset(noon_selection(PRIall_2020, 5, 20), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block4"), aes(x = Time, y = Down570, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 Down570 Diurnal Radiance Late August") + ylab("Radiance (W/m2·sr)") + ylim(c(0.00, 0.03)) + labs(color = "Date")
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

```

###PRI diurnal cycle
####2019
```{r}
##Site 1
p1 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03)) 
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

##Site 2
p1 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 2 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 2 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 2 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 2 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 2 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 2 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03)) 
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)


##Site 3
p1 <- ggplot(subset(noon_selection(PRIall, 11, 19), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall, 11, 19), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall, 11, 19), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall, 11, 19), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall, 11, 19), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall, 11, 19), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03)) 
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

##Site 4
p1 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03)) 
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)


```
####2020
```{r}
##Site 1
p1 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p1
p2 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 1 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03)) 
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

##Site 2
p1 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 2 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p1
p2 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-06-15" & Date < "2020-06-28" & Site == "Block2"), aes(x = Time, y = PRI.2, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 2 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") + ylim(c(-0.25, 0.25))
p2
p3 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-06-15" & Date < "2020-06-28" & Site == "Block2"), aes(x = Time, y = PRI.a, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 2 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") + ylim(c(-0.25, 0.25))
p3


p2 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 2 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 2 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 2 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 2 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 2 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03)) 
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)


##Site 3
p1 <- ggplot(subset(noon_selection(PRIall_2020, 11, 17), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p1
p2 <- ggplot(subset(noon_selection(PRIall_2020, 11, 19), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall_2020, 11, 19), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_2020, 11, 19), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall_2020, 11, 19), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_2020, 11, 19), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 3 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03)) 
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

##Site 4
p1 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p1
p2 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block 4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03)) 
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

```

####Smoothing: aggregate to hourly 
#####2019
```{r}
PRIall$Hour <- lubridate::hour(PRIall$TIMESTAMP)
##Aggregate to 
PRIall_hourly <- aggregate(PRIall$PRI.4, list("Site"=PRIall$Site, "Date"=PRIall$Date, "Time"=PRIall$Hour), FUN = function(x){mean(x, na.rm = TRUE)})
PRIall_hourly <- PRIall_hourly[order(PRIall_hourly$Date),]
names(PRIall_hourly)[4] <- "PRI.4"

#Site 1
p1 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall_hourly, 9, 18), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_hourly, 9, 18), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_hourly, 9, 18), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

#Site 2
p1 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall_hourly, 9, 18), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_hourly, 9, 18), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_hourly, 9, 18), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

#Site 3
p1 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall_hourly, 9, 18), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_hourly, 9, 18), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_hourly, 9, 18), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)


#Site 4
p1 <- ggplot(subset(noon_selection(PRIall, 11, 18), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall_hourly, 11, 18), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall, 11, 18), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_hourly, 11, 18), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall, 11, 18), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_hourly, 11, 18), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)


#Site 4
#Site 4
p1 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall_hourly, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_hourly, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_hourly, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

```
#####2020
```{r}
PRIall_2020$Hour <- lubridate::hour(PRIall_2020$TIMESTAMP)
##Aggregate to 
PRIall_2020_hourly <- aggregate(PRIall_2020$PRI.4, list("Site"=PRIall_2020$Site, "Date"=PRIall_2020$Date, "Time"=PRIall_2020$Hour), FUN = function(x){mean(x, na.rm = TRUE)})
PRIall_2020_hourly <- PRIall_2020_hourly[order(PRIall_2020_hourly$Date),]
names(PRIall_2020_hourly)[4] <- "PRI.4"

p1 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 9, 16), Date>"2020-06-15" & Date < "2020-06-28" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p1
p2 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 9, 16), Date>"2020-06-15" & Date < "2020-06-28" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2
p3 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 9, 16), Date>"2020-06-15" & Date < "2020-06-28" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3
p4 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 9, 16), Date>"2020-05-15" & Date < "2020-05-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p4


p2 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 9, 18), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 9, 18), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 9, 18), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

#Site 2
p1 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 9, 18), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 9, 18), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 9, 18), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

#Site 3
p1 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 9, 18), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 9, 18), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 9, 18), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)


#Site 4
p1 <- ggplot(subset(noon_selection(PRIall_2020, 11, 18), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 11, 18), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall_2020, 11, 18), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 11, 18), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall_2020, 11, 18), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 11, 18), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)


#Site 4
#Site 4
p1 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 11, 16), Date>"2020-06-23" & Date < "2020-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 11, 16), Date>"2020-07-27" & Date < "2020-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall_2020, 11, 16), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_2020_hourly, 11, 16), Date>"2020-08-20" & Date < "2020-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

```

####Smoothing: moving average
```{r}
temp_split <- split(PRIall, list(PRIall$Site, PRIall$Date))
ma_split <- lapply(temp_split, function(x){
  x$PRI.4.ma = rollmean(x$PRI.4, k = 4, fill = NA)
  return(x)
})
PRIall_ma <- do.call(rbind, a)
row.names(PRIall_ma) <- NULL


#Plots
#Site 1
p1 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall_ma, 9, 18), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block1"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_ma, 9, 18), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block1"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block1"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_ma, 9, 18), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block1"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block1 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

#Site 2
p1 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall_ma, 9, 18), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block2"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_ma, 9, 18), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block2"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block2"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_ma, 9, 18), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block2"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block2 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

#Site 3
p1 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall_ma, 9, 18), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block3"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_ma, 9, 18), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block3"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block3"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_ma, 9, 18), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block3"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block3 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)


#Site 4
p1 <- ggplot(subset(noon_selection(PRIall, 11, 18), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall_ma, 11, 18), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall, 11, 18), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_ma, 11, 18), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall, 11, 18), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_ma, 11, 18), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)


#Site 4
#Site 4
p1 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p2 <- ggplot(subset(noon_selection(PRIall_ma, 11, 16), Date>"2019-06-23" & Date < "2019-06-28" & Site == "Block4"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late June")+ ylab("PRI")  + labs(color = "Date") #+ ylim(c(0.00, 0.03))
p3 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late July")+ ylab("PRI") + labs(color = "Date")#+ ylim(c(0.00, 0.03)) 
p4 <- ggplot(subset(noon_selection(PRIall_ma, 11, 16), Date>"2019-07-27" & Date < "2019-08-01" & Site == "Block4"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late July")+ ylab("PRI")  + labs(color = "Date")#+ ylim(c(0.00, 0.03))
p5 <- ggplot(subset(noon_selection(PRIall, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
p6 <- ggplot(subset(noon_selection(PRIall_ma, 11, 16), Date>"2019-08-20" & Date < "2019-08-25" & Site == "Block4"), aes(x = Time, y = PRI.4.ma, color = as.factor(Date))) + geom_point() + geom_line() + ggtitle("Block4 PRI Diurnal Cycle Late August")  + labs(color = "Date") + ylab("PRI")#+ ylim(c(0.00, 0.03))
grid.arrange(p1, p2, p3, p4,p5, p6, nrow = 3, ncol = 2)

```
####Baseline PRI for each day 
```{r}
#use 10am PRI as the baseline 
temp_split <- split(PRIma_weather, list(PRIma_weather$Site, PRIma_weather$Date))
for(i in 1:length(temp_split)){
  #baseline 
  temp_split[[i]]$PRIbl <- subset(temp_split[[i]], Time == 10)$PRI.4.ma
  temp_split[[i]]$PRI.delta <- temp_split[[i]]$PRI.4.ma - temp_split[[i]]$PRIbl
}
PRIma_weather <- do.call(rbind, temp_split)

temp_sb1 <- subset(noon_selection(PRIma_weather, 12, 14), Date >= "2019-07-26" & Date <="2019-08-26" & Site == "Block4")
par(mfrow = c(1,1))
plot(y = temp_sb1$PRI.delta, x = temp_sb1$Sol_Rad, xlim= c(850, 1000))
cor(temp_sb1$PRI.delta, x= temp_sb1$Sol_Rad, use = "complete.obs")^2

temp_sb2 <- subset(noon_selection(PRIma_weather, 14, 16), Date >= "2019-07-26" & Date <="2019-08-26" & Site == "Block4")
plot(x=  temp_sb2$VPD, y = temp_sb2$PRI.4.ma)

cor(temp_sb2$VPD, temp_sb2$PRI.4.ma, use = "complete.obs")^2

cor(temp_sb2$VPD, temp_sb2$PRI.delta, use = "complete.obs")^2


par(mfrow =c(4,3))
dates_pri <- seq.Date(as.Date("2019-05-21"),as.Date("2019-08-26"),"1 day")
for(i in 1:98){
  temp_sb <- subset(noon_selection(PRIma_weather, 10, 19), Date == dates_pri[i] & Site == "Block4")
  plot(x = temp_sb$Time, y = temp_sb$PRI.delta, xlab = "Time", ylab = "PRI Delta", main = paste("Block4",dates_pri[i], sep = " "))
  
}


a <- subset(noon_selection(PRIma_weather, 11, 14), Date >= "2019-07-26" & Date <= "2019-08-26" & Site == "Block4")
a <- subset(a , a$Sol_Rad>700)
plot(x = a$Sol_Rad, y = a$PRI.delta)
cor(x = a$Sol_Rad, y = a$PRI.delta, use = "complete.obs")^2
cor(x = a$Sol_Rad, y = a$PRI.4.ma, use = "complete.obs")^2
ggplot(a, aes(x = Sol_Rad, y = PRI.delta, color = "Solar Radiation")) + geom_point(size = 2) + geom_smooth(method = 'lm', formula = y~x, se = FALSE, colour = "skyblue2", size = 2)+theme(legend.position = "none", text = element_text(size = 14)) + xlab("Solar Radiation (W/m2)") + ylab("PRI delta") + theme_minimal(base_size = 16) + scale_color_manual(values =  'springgreen4')

theme(legend.position = c(0.2, 0.1), text = element_text(size = 14))

b <- subset(noon_selection(PRIma_weather, 13, 17), Date >= "2019-07-26" & Date <= "2019-08-26" & Site == "Block4")
plot(x = b$VPD, y = b$PRI.delta)
cor(x = b$VPD, y = b$PRI.delta, use = "complete.obs")^2
cor(x = b$VPD, y = b$PRI.4.ma, use = "complete.obs")^2

ggplot(b, aes(x = VPD, y = PRI.delta, color = "VPD")) + geom_point(size = 2) + geom_smooth(method = 'lm', formula = y~x, se = FALSE, colour = "skyblue2", size = 2)+theme(legend.position = c(0.2,0.1), text = element_text(size = 12)) + xlab("VPD (kPa)") + ylab("PRI delta")  + scale_color_manual(values = 'tomato') + theme_minimal(base_size = 16)

ggplot(b, aes(x = VPD, y = PRI.delta, color = "VPD")) + geom_point() + geom_smooth(method = 'lm', formula = y~x, se = FALSE, colour = "skyblue2")+theme(text = element_text(size = 18)) + xlab("VPD (kPa)") + ylab("PRI") + theme_minimal() + scale_color_manual(values = 'tomato')


```


####Choose the best one for demonstration 
#####Block 4 on 2019-08-22
```{r}
#combine with hourly weather data
cimis_rip$TIMESTAMP <- force_tz(cimis_rip$TIMESTAMP, tz="UTC")
temp_split <- split(PRIall_ma, PRIall_ma$Site)
length(temp_split)
temp_split <- lapply(temp_split, function(x){merge(x, cimis_rip[,c("Air_Temp","Rel_Hum","Sol_Rad","VPD","TIMESTAMP")], by = "TIMESTAMP", all.x = TRUE)})
PRIma_weather <- do.call(rbind, temp_split)
row.names(PRIma_weather) <- NULL
head(PRIma_weather)
#PRIma_weather <- merge(PRIall_ma, cimis_rip[,c("Air_Temp","Rel_Hum","Sol_Rad","TIMESTAMP")], by = "TIMESTAMP", all.x = TRUE)

#validate whether the tz is correct 
p1<- ggplot(subset(noon_selection(PRIma_weather, 0, 23), Date >= "2019-08-21" & Date <= "2019-08-23" & Site == "Block4"), aes(x = TIMESTAMP, y = Air_Temp, color = "Air Temperature")) + geom_line() + geom_point()
p2 <- ggplot(subset(cimis_rip, Date >= "2019-08-21" & Date <= "2019-08-23"), aes(x = TIMESTAMP, y = Air_Temp, color = "Air Temperature")) + geom_point()
grid.arrange(p1,p2, nrow =2 )


#plot 
ggplot(subset(noon_selection(PRIma_weather, 10, 19), Date == "2019-08-21" & Site == "Block4"), aes(x = Time, y = Sol_Rad)) + geom_point()
ggplot(subset(noon_selection(PRIma_weather, 10, 19), Date == "2019-08-21" & Site == "Block4"), aes(x = Time, y = VPD)) + geom_point()

##Air Temperature
p1 <- ggplot(subset(noon_selection(PRIma_weather, 10, 19), Date == "2019-08-22" & Site == "Block4"), aes(x = Time)) + geom_line(aes(y = PRI.4.ma, color = "PRI"), size = 0.8)  + geom_point(aes(y = Air_Temp*0.05-1.45, color = "Air Temperature"), size = 1.5) + scale_y_continuous(sec.axis = sec_axis(~(.+1.45)/0.05, name = "Air Temperature (°C)"))  + labs(y = "PRI", x = "Time of Day", color = "Legend")  + theme(legend.position = c(0.2, 0.1), text = element_text(size = 14)) + scale_x_continuous(breaks = seq(10, 19, 2)) + scale_color_manual(values = c("tomato", "steelblue3")) + ggtitle("2019-08-22 Block 4")
p1
##Solar Radiation 
p2 <- ggplot(subset(noon_selection(PRIma_weather, 10, 19), Date == "2019-08-22" & Site == "Block4"), aes(x = Time)) + geom_line(aes(y = PRI.4.ma, color = "PRI"), size = 0.8)  + geom_point(aes(y = Sol_Rad*0.00067, color = "Solar Radiation"), size = 1.5) + scale_y_continuous(sec.axis = sec_axis(~(.)/0.00067, name = "Solar Radiation (W/m2)"), breaks = seq(-0.2, 0.7, 0.2))  + labs(y = "PRI", x = "Time of Day", color = "Legend") + scale_color_manual(values = c("steelblue3", "hotpink3")) + theme(legend.position = c(0.2, 0.1), text = element_text(size = 12)) + scale_x_continuous(breaks = seq(10, 19, 2))
p2
##VPD
p3 <- ggplot(subset(noon_selection(PRIma_weather, 10, 19), Date == "2019-08-22" & Site == "Block4"), aes(x = Time)) + geom_line(aes(y = PRI.4.ma, color = "PRI"), size = 0.8)  + geom_point(aes(y = VPD*0.25-0.575, color = "VPD"), size = 1.5) + scale_y_continuous(sec.axis = sec_axis(~(.+0.575)/0.25, name = "Vapor Pressure Deficit (kPa)"))  + labs(y = "PRI", x = "Time of Day", color = "Legend") + scale_color_manual(values = c("steelblue3", "tomato")) + theme(legend.position = c(0.4, 0.1) ,text = element_text(size = 14)) + scale_x_continuous(breaks = seq(10, 19, 2)) 
p3


par(mfrow =c(4,3))
dates_pri <- seq.Date(as.Date("2019-05-21"),as.Date("2019-08-26"),"1 day")
for(i in 1:98){
  temp_sb <- subset(noon_selection(PRIma_weather, 10, 19), Date == dates_pri[i] & Site == "Block4")
  plot(x = temp_sb$Time, y = temp_sb$PRI.4.ma, xlab = "Time", ylab = "PRI", main = paste("Block4",dates_pri[i], sep = " "))
  
}

names(PRIma_weather) 
PRIma_weather
temp_sb1 <- subset(noon_selection(PRIma_weather, 12, 14), Date >= "2019-07-26" & Date <="2019-08-26" & Site == "Block4")
par(mfrow = c(1,1))
plot(y = temp_sb1$PRI.4.ma, x = temp_sb1$Sol_Rad)

temp_sb2 <- subset(noon_selection(PRIma_weather, 14, 16), Date >= "2019-07-26" & Date <="2019-08-26" & Site == "Block4")
plot(x=  temp_sb2$VPD, y = temp_sb2$PRI.4.ma)

cor(temp_sb2$VPD, temp_sb2$PRI.4.ma, use = "complete.obs")^2
```


#-----------------------------------------------
#For GRAPEX Meeting Presentation 
##Diurnal Cycle
```{r}
#Diurnal Cycle
##with legend
p2 <- ggplot(subset(noon_selection(PRIma_weather, 10, 19), Date == "2019-08-22" & Site == "Block4"), aes(x = Time)) + geom_line(aes(y = PRI.4.ma, color = "PRI"), size = 0.8)  + geom_point(aes(y = Sol_Rad*0.00067, color = "Solar Radiation"), size = 1.5) + scale_y_continuous(sec.axis = sec_axis(~(.)/0.00067, name = "Solar Radiation (W/m2)"), breaks = seq(-0.2, 0.7, 0.2))  + labs(y = "PRI", x = "Time of Day", color = "Legend") + scale_color_manual(values = c("steelblue3", "springgreen4")) + theme( text = element_text(size = 14)) + scale_x_continuous(breaks = seq(10, 19, 2))
p2
p3 <- ggplot(subset(noon_selection(PRIma_weather, 10, 19), Date == "2019-08-22" & Site == "Block4"), aes(x = Time)) + geom_line(aes(y = PRI.4.ma, color = "PRI"), size = 0.8)  + geom_point(aes(y = VPD*0.25-0.575, color = "VPD"), size = 1.5) + scale_y_continuous(sec.axis = sec_axis(~(.+0.575)/0.25, name = "Vapor Pressure Deficit (kPa)"))  + labs(y = "PRI", x = "Time of Day", color = "Legend") + scale_color_manual(values = c("steelblue3", "tomato")) + theme(text = element_text(size = 14)) + scale_x_continuous(breaks = seq(10, 19, 2)) 
p3
##Without legend
p2 <- ggplot(subset(noon_selection(PRIma_weather, 10, 19), Date == "2019-08-22" & Site == "Block4"), aes(x = Time)) + geom_line(aes(y = PRI.4.ma, color = "PRI"), size = 0.8)  + geom_point(aes(y = Sol_Rad*0.00067, color = "Solar Radiation"), size = 1.5) + scale_y_continuous(sec.axis = sec_axis(~(.)/0.00067, name = "Solar Radiation (W/m2)"), breaks = seq(-0.2, 0.7, 0.2))  + labs(y = "PRI", x = "Time of Day", color = "Legend") + scale_color_manual(values = c("steelblue3", "springgreen4")) + theme(legend.position = "none", text = element_text(size = 14)) + scale_x_continuous(breaks = seq(10, 19, 2))
p2
p3 <- ggplot(subset(noon_selection(PRIma_weather, 10, 19), Date == "2019-08-22" & Site == "Block4"), aes(x = Time)) + geom_line(aes(y = PRI.4.ma, color = "PRI"), size = 0.8)  + geom_point(aes(y = VPD*0.25-0.575, color = "VPD"), size = 1.5) + scale_y_continuous(sec.axis = sec_axis(~(.+0.575)/0.25, name = "Vapor Pressure Deficit (kPa)"))  + labs(y = "PRI", x = "Time of Day", color = "Legend") + scale_color_manual(values = c("steelblue3", "tomato")) + theme(legend.position = "none",text = element_text(size = 14)) + scale_x_continuous(breaks = seq(10, 19, 2)) 
p3
grid.arrange(p2, p3, nrow = 2)


```
##Correlation with weather information diurnal
```{r}
a <- subset(noon_selection(PRIma_weather, 11, 14), Date >= "2019-07-26" & Date <= "2019-08-26" & Site == "Block4")
a <- subset(a , a$Sol_Rad>700)
ggplot(a, aes(x = Sol_Rad, y = PRI.delta, color = "Solar Radiation")) + geom_point(size = 2) + geom_smooth(method = 'lm', formula = y~x, se = FALSE, colour = "skyblue2", size = 2)+theme(legend.position = "none", text = element_text(size = 14)) + xlab("Solar Radiation (W/m2)") + ylab("PRI delta") + theme_minimal(base_size = 16) + scale_color_manual(values =  'springgreen4')


b <- subset(noon_selection(PRIma_weather, 13, 17), Date >= "2019-07-26" & Date <= "2019-08-26" & Site == "Block4")
plot(x = b$VPD, y = b$PRI.delta)
cor(x = b$VPD, y = b$PRI.delta, use = "complete.obs")^2
cor(x = b$VPD, y = b$PRI.4.ma, use = "complete.obs")^2
ggplot(b, aes(x = VPD, y = PRI.delta, color = "VPD")) + geom_point(size = 2) + geom_smooth(method = 'lm', formula = y~x, se = FALSE, colour = "skyblue2", size = 2)+theme(legend.position = c(0.2,0.1), text = element_text(size = 12)) + xlab("VPD (kPa)") + ylab("PRI delta")  + scale_color_manual(values = 'tomato') + theme_minimal(base_size = 16)

```

##Seasonal Change
